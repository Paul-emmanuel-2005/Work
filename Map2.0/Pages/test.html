<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--=============== FAVICON ===============-->
    <link rel="shortcut icon" href="../assets/img/favicon1.png" type="image/x-icon">

    <!--=============== REMIXICONS ===============-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">

    <!-- ===================== FONTAWESOME ICON =================-->
    <script src="https://kit.fontawesome.com/bd73f26977.js" crossorigin="anonymous"></script>

    <!--=============== SWIPER CSS ===============-->
    <link rel="stylesheet" href="../assets/css/swiper-bundle.min.css">

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="../assets/css/styles.css">

    <!-- ============== LEAFLET LINK =====================-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!--================LEAFLET JS =====================-->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>



    <title>DAP Mapping App</title>
</head>

<style>
    .custom-marker {
        background-color: red;
        border-radius: 50%;
        width: 10px;
        height: 10px;
        display: inline-block;
    }
</style>

<body>
    <!--==================== HEADER ====================-->
    <header class="header" id="header">
        <nav class="nav container">
            <a href="./index.html" class="nav__logo">
                <i class="fa-regular fa-map"></i>
                <span>DAP Mapping</span>
            </a>

            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                    <li>
                        <a href="./index.html" class="nav__link active-link">Home</a>
                    </li>
                    <li>
                        <a href="#contact" class="nav__link button">Contact Us</a>
                    </li>
                </ul>

                <!-- Close button -->
                <div class="nav__close" id="nav-close">
                    <i class="ri-close-large-line"></i>
                </div>
            </div>

            <!-- Toggle menu -->
            <div class="nav__toggle" id="nav-toggle">
                <i class="ri-apps-2-line"></i>
            </div>
        </nav>
    </header>

    <!--==================== MAIN ====================-->
    <main class="main">
        <!--==================== HOME ====================-->
        <section class="home section" id="home">
            <img src="../assets/img/home-lines-bg.svg" alt="image" class="home__lines">

            <div class="home__container container grid">
                <div class="home__content grid">
                    <div class="home__data">
                        <h1 class="home__title">
                            Service
                            de cartographie : Visualisations précises et intuitives.</h1>

                        <p class="home__description">
                            Nous vous offrons les meilleures solutions de cartographie pour optimiser la gestion des
                            agents de pharmacie, afin de vous aider à prendre des décisions éclairées.
                        </p>

                        <div class="home__buttons">
                            <a href="#map" class="button">Explore Map</a>
                        </div>
                    </div>

                    <div class="home__info">
                        <div>
                            <h3 class="home__info-title">5+</h3>
                            <p class="home__info-description">Régions <br> Mappées</p>
                        </div>

                        <div>
                            <h3 class="home__info-title">20+</h3>
                            <p class="home__info-description">Agents <br> Mappés</p>
                        </div>
                    </div>
                </div>

                <div class="home__images">
                    <img src="../assets/img/Carto.jpg" alt="image" class="home__img-1">
                    <img src="../assets/img/Carto1.webp" alt="image" class="home__img-2">
                </div>
            </div>
        </section>

        <!--================== BARRE DE RECHERCHE ===============-->
        <div class="search-bar"> <label for="search">Recherchez un agent :</label> <input type="text" id="search"
                name="search" oninput="filterFunction()" autocomplete="off" class="search-input">
            <div id="myDropdown" class="dropdown-content"></div>
        </div>

        <!--==================== MAP ====================-->
        <div id="map" style="height: 500px;"></div>

        <!--==================== CONTACT ====================-->
        <section class="contact section" id="contact">
            <div class="container">
                <span class="section__subtitle">CONTACT ME</span>
                <h2 class="section__title">Write Us</h2>

                <div class="contact__container grid">
                    <img src="../assets/img/dap-logo.png" alt="image" class="contact__img">

                    <div class="contact__data grid">
                        <div class="contact__card">
                            <div class="contact__icon">
                                <i class="ri-map-pin-2-line"></i>
                            </div>

                            <h3 class="contact__title">Nous Sommes</h3>
                            <address class="contact__info">
                                Abidjan - Treichville <br>
                                Blvrd Marseille KM4
                            </address>
                        </div>

                        <div class="contact__card">
                            <div class="contact__icon">
                                <i class="ri-phone-line"></i>
                            </div>

                            <h3 class="contact__title">Nous Joindre</h3>
                            <address class="contact__info">
                                21 21 3 57313 <br>
                            </address>
                        </div>

                        <div class="contact__card">
                            <div class="contact__icon">
                                <i class="ri-message-3-line"></i>
                            </div>

                            <h3 class="contact__title">Chat with us</h3>

                            <div class="contact__social">
                                <a href="https://api.whatsapp.com/" target="_blank" class="contact__social-link">
                                    <i class="ri-whatsapp-line"></i>
                                </a>

                                <a href="https://m.me/" target="_blank" class="contact__social-link">
                                    <i class="ri-messenger-line"></i>
                                </a>

                                <a href="https://t.me/" target="_blank" class="contact__social-link">
                                    <i class="ri-telegram-line"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!--==================== FOOTER ====================-->
    <footer class="footer">
        <div class="footer__container container grid">
            <div>
                <a href="#" class="footer__logo">
                    <i class="fa-regular fa-map"></i>
                    <span>DAP Mapping</span>
                </a>

                <p class="footer__description">Un service de Cartographie <br> Moderne et immersif.</p>
                <address class="footer__email"><a href="mailto:info@dap.ci">Email: info@dap.ci</a></address>
            </div>

            <div class="footer__content grid">
                <div>
                    <h3 class="footer__title">Company</h3>
                    <ul class="footer__links">
                        <li>
                            <a href="#contact" class="footer__link">Contact Us</a>
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="footer__title">Information</h3>
                    <ul class="footer__list">
                        <li>
                            <address class="footer__info">Abidjan - Treichville <br> Blvrd Marseille KM4</address>
                        </li>

                        <li>
                            <address class="footer__info">07H - 18H</address>
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="footer__title">Social Media</h3>
                    <div class="footer__social">
                        <a href="https://www.facebook.com/" target="_blank" class="footer__social-link">
                            <i class="ri-facebook-circle-line"></i>
                        </a>

                        <a href="https://www.instagram.com/" target="_blank" class="footer__social-link">
                            <i class="ri-instagram-line"></i>
                        </a>

                        <a href="https://twitter.com/" target="_blank" class="footer__social-link">
                            <i class="ri-twitter-x-fill"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <span class="footer__copy">
            &#169; All Rights Reserved By Paul Emmanuel Kama
        </span>
    </footer>

    <!--========== SCROLL UP ==========-->
    <a href="#" class="scrollup" id="scroll-up">
        <i class="ri-arrow-up-line"></i>
    </a>

    <!--=============== SCROLLREVEAL ===============-->
    <script src="../assets/js/scrollreveal.min.js"></script>

    <!--=============== SWIPER JS ===============-->
    <script src="../assets/js/swiper-bundle.min.js"></script>

    <!--=============== MAIN JS ===============-->
    <script src="../assets/js/main.js"></script>

    <!--=============== SCRIPT POUR LA MAP LEAFLET ===========-->
    <script>
        // Initialiser la carte avec des coordonnées centrées sur la Côte d'Ivoire
        // Crée la carte centrée sur la Côte d'Ivoire 
        var map = L.map('map').setView([7.539989, -5.547080], 7);
        // Coordonnées de la Côte d'Ivoire // Ajoute une couche de tuiles (tiles)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);
        // Crée un groupe de marqueurs (clusters) 
        var markers = L.markerClusterGroup();
        // Récupère les données depuis ton API 
        fetch('http://localhost/Map2.0/Api/api.php')
            .then(response => {
                if (!response.ok) { throw new Error('Network response was not ok'); }
                return response.json();
            }).then(data => {
                // Parcourir chaque établissement retourné par l'API
                data.forEach(etablissement => {
                    // Crée un marqueur personnalisé en tant que divIcon 
                    var marker = L.divIcon({ className: 'custom-marker', html: '<div class="custom-marker"></div>' });
                    // Ajoute le marqueur au groupe de clusters 
                    markers.addLayer(L.marker([etablissement.LAT, etablissement.LNG], { icon: marker }).bindPopup(` <strong>${etablissement.NOM} ${etablissement.PRENOMS}</strong> <br> <p><strong>Emploi :</strong> ${etablissement.EMPLOI}</p> <p><strong>Contact :</strong> ${etablissement.CONTACT}</p> `));
                });
                // Ajoute le groupe de clusters à la carte 
                map.addLayer(markers);
            })
            .catch(error => { console.error('Il y a eu un problème avec la requête Fetch :', error); });

        // Fonction pour filtrer les résultats de recherche
        function filterFunction() { 
    const input = document.getElementById("search").value.toLowerCase(); 
    const div = document.getElementById("myDropdown"); 
    div.innerHTML = ""; 
    if (input.length > 0) { 
        fetch(`http://localhost/Map2.0/Api/api.php`) 
        .then(response => response.json()) 
        .then(data => { 
            data.forEach(etablissement => { 
                if (etablissement.NOM.toLowerCase().startsWith(input)) { 
                    const a = document.createElement("a"); 
                    a.href = "#"; 
                    a.textContent = etablissement.NOM.charAt(0).toUpperCase() + etablissement.NOM.slice(1); 
                    a.addEventListener("click", function (e) { 
                        e.preventDefault(); 
                        map.setView([etablissement.LAT, etablissement.LNG], 19); 
                        // Masquer le dropdown après le clic 
                        div.classList.remove("show"); 
                    }); 
                    div.appendChild(a); 
                } 
            }); 
            div.classList.add("show"); 
        }) 
        .catch(error => { 
            console.error('Il y a eu un problème avec la requête Fetch :', error); 
        }); 
    } else { 
        div.classList.remove("show"); 
    } 
}
    </script>
</body>

</html>